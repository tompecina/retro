
char board[9] = {0, 0, 0, 0, 0, 0, 0, 0, 0};

char presseq[10] = " PrESS = ";

unsigned char disp[9];

main() {  
  unsigned char r, c;
  init8255();
  splashscreen();
  asc2buf(presseq, disp);
  while (wfk(disp) != '=');
  for (r = 0; r < 3; r++) {
    for (c = 0; c < 3; c++) {
      clearsym(r, c);
    }
  }
  while (wfk(disp) != '=');
}

splashscreen() {
  clearmatrix();
  paintgrid();
  paintsym(0, 0, 3);
  paintsym(0, 1, 4);
  paintsym(0, 2, 5);
  paintsym(1, 0, 6);
  paintsym(1, 1, 7);
  paintsym(1, 2, 8);
  paintsym(2, 0, 9);
  paintsym(2, 1, 10);
  paintsym(2, 2, 11);
}

#define RED 1
#define GREEN 2
#define YELLOW 3
#define WHITE 4

#define BASEPORT 0x1c

setled(unsigned char row, unsigned char col, unsigned char state) {
  outp(BASEPORT, row);
  outp(BASEPORT + 1, col);
  outp(BASEPORT + 2, state);
}

clearmatrix() {
  unsigned char r, c;
  for (r = 0; r < 32; r++) {
    for (c = 0; c < 32; c++) {
      setled(r, c, 0);
    }
  }
}

paintgrid() {
  unsigned char i;
  for (i = 0; i < 32; i++) {
    setled(i, 10, WHITE);
    setled(i, 21, WHITE);
    setled(10, i, WHITE);
    setled(21, i, WHITE);
  }
}

unsigned char symbols[1200] = {
  0, 0, 0, 0, 0, 0, 0, 0, 0, 0,  /* 0 = blank */
  0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
  0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
  0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
  0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
  0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
  0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
  0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
  0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
  0, 0, 0, 0, 0, 0, 0, 0, 0, 0,

  0, 0, 0, 0, 0, 0, 0, 0, 0, 0,  /* 1 = red nought */
  0, 0, 0, 1, 1, 1, 1, 0, 0, 0,
  0, 0, 1, 0, 0, 0, 0, 1, 0, 0,
  0, 1, 0, 0, 0, 0, 0, 0, 1, 0,
  0, 1, 0, 0, 0, 0, 0, 0, 1, 0,
  0, 1, 0, 0, 0, 0, 0, 0, 1, 0,
  0, 1, 0, 0, 0, 0, 0, 0, 1, 0,
  0, 0, 1, 0, 0, 0, 0, 1, 0, 0,
  0, 0, 0, 1, 1, 1, 1, 0, 0, 0,
  0, 0, 0, 0, 0, 0, 0, 0, 0, 0,

  0, 0, 0, 0, 0, 0, 0, 0, 0, 0,  /* 2 = green cross */
  0, 2, 0, 0, 0, 0, 0, 0, 2, 0,
  0, 0, 2, 0, 0, 0, 0, 2, 0, 0,
  0, 0, 0, 2, 0, 0, 2, 0, 0, 0,
  0, 0, 0, 0, 2, 2, 0, 0, 0, 0,
  0, 0, 0, 0, 2, 2, 0, 0, 0, 0,
  0, 0, 0, 2, 0, 0, 2, 0, 0, 0,
  0, 0, 2, 0, 0, 0, 0, 2, 0, 0,
  0, 2, 0, 0, 0, 0, 0, 0, 2, 0,
  0, 0, 0, 0, 0, 0, 0, 0, 0, 0,

  0, 0, 0, 0, 0, 0, 0, 0, 0, 0,  /* 3 = red T */
  0, 1, 1, 1, 1, 1, 1, 1, 1, 0,
  0, 1, 1, 1, 1, 1, 1, 1, 1, 0,
  0, 0, 0, 0, 1, 1, 0, 0, 0, 0,
  0, 0, 0, 0, 1, 1, 0, 0, 0, 0,
  0, 0, 0, 0, 1, 1, 0, 0, 0, 0,
  0, 0, 0, 0, 1, 1, 0, 0, 0, 0,
  0, 0, 0, 0, 1, 1, 0, 0, 0, 0,
  0, 0, 0, 0, 1, 1, 0, 0, 0, 0,
  0, 0, 0, 0, 0, 0, 0, 0, 0, 0,

  0, 0, 0, 0, 0, 0, 0, 0, 0, 0,  /* 4 = green I */
  0, 0, 0, 0, 2, 2, 0, 0, 0, 0,
  0, 0, 0, 0, 2, 2, 0, 0, 0, 0,
  0, 0, 0, 0, 2, 2, 0, 0, 0, 0,
  0, 0, 0, 0, 2, 2, 0, 0, 0, 0,
  0, 0, 0, 0, 2, 2, 0, 0, 0, 0,
  0, 0, 0, 0, 2, 2, 0, 0, 0, 0,
  0, 0, 0, 0, 2, 2, 0, 0, 0, 0,
  0, 0, 0, 0, 2, 2, 0, 0, 0, 0,
  0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
  
  0, 0, 0, 0, 0, 0, 0, 0, 0, 0,  /* 5 = yellow C */
  0, 3, 3, 3, 3, 3, 3, 3, 3, 0,
  0, 3, 3, 3, 3, 3, 3, 3, 3, 0,
  0, 3, 3, 0, 0, 0, 0, 0, 0, 0,
  0, 3, 3, 0, 0, 0, 0, 0, 0, 0,
  0, 3, 3, 0, 0, 0, 0, 0, 0, 0,
  0, 3, 3, 0, 0, 0, 0, 0, 0, 0,
  0, 3, 3, 3, 3, 3, 3, 3, 3, 0,
  0, 3, 3, 3, 3, 3, 3, 3, 3, 0,
  0, 0, 0, 0, 0, 0, 0, 0, 0, 0,

  0, 0, 0, 0, 0, 0, 0, 0, 0, 0,  /* 6 = green T */
  0, 2, 2, 2, 2, 2, 2, 2, 2, 0,
  0, 2, 2, 2, 2, 2, 2, 2, 2, 0,
  0, 0, 0, 0, 2, 2, 0, 0, 0, 0,
  0, 0, 0, 0, 2, 2, 0, 0, 0, 0,
  0, 0, 0, 0, 2, 2, 0, 0, 0, 0,
  0, 0, 0, 0, 2, 2, 0, 0, 0, 0,
  0, 0, 0, 0, 2, 2, 0, 0, 0, 0,
  0, 0, 0, 0, 2, 2, 0, 0, 0, 0,
  0, 0, 0, 0, 0, 0, 0, 0, 0, 0,

  0, 0, 0, 0, 0, 0, 0, 0, 0, 0,  /* 7 = yellow A */
  0, 3, 3, 3, 3, 3, 3, 3, 3, 0,
  0, 3, 3, 3, 3, 3, 3, 3, 3, 0,
  0, 3, 3, 0, 0, 0, 0, 3, 3, 0,
  0, 3, 3, 0, 0, 0, 0, 3, 3, 0,
  0, 3, 3, 3, 3, 3, 3, 3, 3, 0,
  0, 3, 3, 3, 3, 3, 3, 3, 3, 0,
  0, 3, 3, 0, 0, 0, 0, 3, 3, 0,
  0, 3, 3, 0, 0, 0, 0, 3, 3, 0,
  0, 0, 0, 0, 0, 0, 0, 0, 0, 0,

  0, 0, 0, 0, 0, 0, 0, 0, 0, 0,  /* 8 = red C */
  0, 1, 1, 1, 1, 1, 1, 1, 1, 0,
  0, 1, 1, 1, 1, 1, 1, 1, 1, 0,
  0, 1, 1, 0, 0, 0, 0, 0, 0, 0,
  0, 1, 1, 0, 0, 0, 0, 0, 0, 0,
  0, 1, 1, 0, 0, 0, 0, 0, 0, 0,
  0, 1, 1, 0, 0, 0, 0, 0, 0, 0,
  0, 1, 1, 1, 1, 1, 1, 1, 1, 0,
  0, 1, 1, 1, 1, 1, 1, 1, 1, 0,
  0, 0, 0, 0, 0, 0, 0, 0, 0, 0,

  0, 0, 0, 0, 0, 0, 0, 0, 0, 0,  /* 9 = yellow T */
  0, 3, 3, 3, 3, 3, 3, 3, 3, 0,
  0, 3, 3, 3, 3, 3, 3, 3, 3, 0,
  0, 0, 0, 0, 3, 3, 0, 0, 0, 0,
  0, 0, 0, 0, 3, 3, 0, 0, 0, 0,
  0, 0, 0, 0, 3, 3, 0, 0, 0, 0,
  0, 0, 0, 0, 3, 3, 0, 0, 0, 0,
  0, 0, 0, 0, 3, 3, 0, 0, 0, 0,
  0, 0, 0, 0, 3, 3, 0, 0, 0, 0,
  0, 0, 0, 0, 0, 0, 0, 0, 0, 0,

  0, 0, 0, 0, 0, 0, 0, 0, 0, 0,  /* 10 = red O */
  0, 1, 1, 1, 1, 1, 1, 1, 1, 0,
  0, 1, 1, 1, 1, 1, 1, 1, 1, 0,
  0, 1, 1, 0, 0, 0, 0, 1, 1, 0,
  0, 1, 1, 0, 0, 0, 0, 1, 1, 0,
  0, 1, 1, 0, 0, 0, 0, 1, 1, 0,
  0, 1, 1, 0, 0, 0, 0, 1, 1, 0,
  0, 1, 1, 1, 1, 1, 1, 1, 1, 0,
  0, 1, 1, 1, 1, 1, 1, 1, 1, 0,
  0, 0, 0, 0, 0, 0, 0, 0, 0, 0,

  0, 0, 0, 0, 0, 0, 0, 0, 0, 0,  /* 11 = green E */
  0, 2, 2, 2, 2, 2, 2, 2, 2, 0,
  0, 2, 2, 2, 2, 2, 2, 2, 2, 0,
  0, 2, 2, 0, 0, 0, 0, 0, 0, 0,
  0, 2, 2, 2, 2, 2, 2, 0, 0, 0,
  0, 2, 2, 2, 2, 2, 2, 0, 0, 0,
  0, 2, 2, 0, 0, 0, 0, 0, 0, 0,
  0, 2, 2, 2, 2, 2, 2, 2, 2, 0,
  0, 2, 2, 2, 2, 2, 2, 2, 2, 0,
  0, 0, 0, 0, 0, 0, 0, 0, 0, 0
};

paintsym(unsigned char row, unsigned char col, unsigned char sym) {
  unsigned char r, c;
  row *= 11;
  col *= 11;
  for (r = 0; r < 10; r++) {
    for (c = 0; c < 10; c++) {
      setled(row + r,
	     col + c,
	     symbols[(sym * 100) + (r * 10) + c]);
    }
  }
}

clearsym(unsigned char row, unsigned char col) {
  unsigned char r, c;
  row *= 11;
  col *= 11;
  for (r = 0; r < 10; r++) {
    for (c = 0; c < 10; c++) {
      setled(row + r, col + c, 0);
    }
  }
}

#define CURSORCOLOR 3

setcursor(unsigned char row, unsigned char col) {
  unsigned char i;
  row *= 11;
  col *= 11;
  for (i = 0; i < 10; i++) {
    setled(row, col + i, CURSORCOLOR);
    setled(row + i, col + 9, CURSORCOLOR);
    setled(row + 9, col + i, CURSORCOLOR);
    setled(row + i, col, CURSORCOLOR);
  }
}

clearcursor(unsigned char row, unsigned char col) {
  unsigned char i;
  row *= 11;
  col *= 11;
  for (i = 0; i < 10; i++) {
    setled(row, col + i, 0);
    setled(row + i, col + 9, 0);
    setled(row + 9, col + i, 0);
    setled(row + i, col, 0);
  }
}

